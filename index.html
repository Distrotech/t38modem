<!DOCTYPE html>
<html>
  <head>
    <meta charset='utf-8'>
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <link href='https://fonts.googleapis.com/css?family=Chivo:900' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" type="text/css" href="stylesheets/stylesheet.css" media="screen" />
    <link rel="stylesheet" type="text/css" href="stylesheets/pygment_trac.css" media="screen" />
    <link rel="stylesheet" type="text/css" href="stylesheets/print.css" media="print" />
    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <title>T38modem by Distrotech</title>
  </head>

  <body>
    <div id="container">
      <div class="inner">

        <header>
          <h1>T38modem</h1>
          <h2></h2>
        </header>

        <section id="downloads" class="clearfix">
          <a href="https://github.com/Distrotech/t38modem/zipball/master" id="download-zip" class="button"><span>Download .zip</span></a>
          <a href="https://github.com/Distrotech/t38modem/tarball/master" id="download-tar-gz" class="button"><span>Download .tar.gz</span></a>
          <a href="https://github.com/Distrotech/t38modem" id="view-on-github" class="button"><span>View on GitHub</span></a>
        </section>

        <hr>

        <section id="main_content">
          <p>/*</p>

<ul>
<li>README
*</li>
<li>T38FAX Pseudo Modem
*</li>
<li>Original author: Vyacheslav Frolov
*
*/</li>
</ul><h2>
<a name="1-introduction" class="anchor" href="#1-introduction"><span class="octicon octicon-link"></span></a>1. Introduction</h2>

<p>What is t38modem?</p>

<p>From your fax or voice application view point it's a fax/voice modem pool.
From IP network view point it's a H.323/SIP endpoint with T.38 fax support.
From your view point it's a gateway between an application and IP network.</p>

<p>The homepage for t38modem project is <a href="http://t38modem.sourceforge.net/">http://t38modem.sourceforge.net/</a>.</p>

<h2>
<a name="2-building" class="anchor" href="#2-building"><span class="octicon octicon-link"></span></a>2. Building</h2>

<h2>
<a name="21-building-for-unix" class="anchor" href="#21-building-for-unix"><span class="octicon octicon-link"></span></a>2.1. Building for Unix</h2>

<p>Building with Open H323 Library:</p>

<p>$ export PWLIBDIR=$path_to_libs/pwlib
  $ export OPENH323DIR=$path_to_libs/openh323
  $ make NO_PBOOLEAN=1 opt</p>

<p>Building with H323 Plus Library:</p>

<p>$ export PTLIBDIR=$path_to_libs/ptlib
  $ export OPENH323DIR=$path_to_libs/h323plus
  $ make opt</p>

<p>Building with Open Phone Abstraction Library (OPAL):</p>

<p>$ export PTLIBDIR=$path_to_libs/ptlib
  $ export OPALDIR=$path_to_libs/opal
  $ make USE_OPAL=1 opt</p>

<h2>
<a name="22-building-for-windows" class="anchor" href="#22-building-for-windows"><span class="octicon octicon-link"></span></a>2.2. Building for Windows</h2>

<p>Building with Open H323 Library:</p>

<p>Start Microsoft Visual C++ 2005 with h323lib\t38modem_openh323_2005.vcproj file.
  Set Active Configuration to "t38modem - Win32 Release".
  Build t38modem.exe.</p>

<p>Building with H323 Plus Library:</p>

<p>Start Microsoft Visual C++ 2005 with h323lib\t38modem_2005.vcproj file.
  Set Active Configuration to "t38modem - Win32 Release".
  Build t38modem.exe.</p>

<p>Building with Open Phone Abstraction Library (OPAL):</p>

<p>Start Microsoft Visual C++ 2005 with opal\t38modem_2005.vcproj file.
  Set Active Configuration to "t38modem - Win32 Release".
  Build t38modem.exe.</p>

<h2>
<a name="3-examples" class="anchor" href="#3-examples"><span class="octicon octicon-link"></span></a>3. Examples</h2>

<p>To get info about t38modem command line syntax enter:</p>

<p>$ t38modem --help</p>

<h2>
<a name="31-starting" class="anchor" href="#31-starting"><span class="octicon octicon-link"></span></a>3.1. Starting</h2>

<p>Starting with Open H323 Library or H323 Plus Library:</p>

<p>$ t38modem -n -o trace.log -p ttyx0,ttyx1 --old-asn \
                               --route 0@127.0.0.1 --route all@172.16.33.21</p>

<p>This will create two modems (/dev/ttyx0 and /dev/ttyx1) and H.323 endpoint.
If dialed number begins with '0' then it will be routed to a local host
(leading '0' will be discarded). Other dialed numbers will be routed to
172.16.33.21.</p>

<p>Starting with OPAL:</p>

<p>$ t38modem -n -o trace.log -p ttyx0,ttyx1 \
                               --route "modem:0.*=h323:@127.0.0.1" \
                               --route "modem:1.*=sip:@172.16.33.20" \
                               --route "modem:2.*=h323:@172.16.33.21" \
                               --route "h323:.*=modem:" \
                               --route "sip:.*=modem:"</p>

<p>This will create two modems (/dev/ttyx0 and /dev/ttyx1) and H.323 and SIP endpoints.
If dialed number begins with '0' then it will be routed to a local host.
If dialed number begins with '1' then it will be routed to SIP endpoint 172.16.33.20.
If dialed number begins with '2' then it will be routed to H.323 endpoint 172.16.33.21.
Leading '0', '1' and '2' will be discarded.</p>

<p>Q. I try to use T38modem, but after run "t38modem -p ttyx0" I get a message
   "Could not open /dev/ptyx0: No such file or directory".
A. Looks like you don't have legacy PTY devices compiled in your kernel.
   You need to re-compile the kernel with 'Legacy PTY Support'.
   Alternatively, you can build t38modem with USE_UNIX98_PTY=1 option and use
   -p +/dev/ttyx0,+/dev/ttyx1 instead of -p ttyx0,ttyx1.</p>

<p>FreeBSD Users: You need to use  -p ttypa,ttypb instead of -p ttyx0,ttyx1.
               Remember to replace ttyx0 with ttypa and ttyx1 with ttypb
               when following the rest of these instructions.
               This will create two modems /dev/ttypa and /dev/ttypb.</p>

<p>Windows Users: You need two COM ports connected via Null-modem cable to create one modem.
               If your COM1 connected to COM2 and COM3 connected to COM4 you need to use
               -p \.\COM2,\.\COM4 instead of  -p ttyx0,ttyx1.
               This will create two modems COM1 and COM3.
               Q. How to use t38modem without additional COM port hardware on Windows?
               A. Replace a pair of physical COM ports with a pair of virtual COM ports.
                  See <a href="http://com0com.sourceforge.net/">http://com0com.sourceforge.net/</a> project for details.
               Q. What model of modem to select in Add Hardware Wizard?
               A. Select "Standard 1440 bps Modem".</p>

<p>Cisco Users:   Possible additionaly you will need to use --h245tunneldisable option.</p>

<h2>
<a name="32-testing-you-need-two-consoles" class="anchor" href="#32-testing-you-need-two-consoles"><span class="octicon octicon-link"></span></a>3.2. Testing (you need two consoles)</h2>

<p>(FreeBSD users - remeber to use /dev/ttypa and /dev/ttypb with 'cu -l')
(Windows users - use COM1 and COM3 with HyperTerminal)</p>

<p>$ cu -l /dev/ttyx0      $ cu -l /dev/ttyx1
Connected.          Connected.
&lt;-- at                  &lt;-- at
--&gt; OK                      --&gt; OK
                            (wait at least 10 secs)
&lt;-- atdt012345</p>

<pre><code>                        --&gt;
                        --&gt; RING
                        --&gt;
                        --&gt; RING
                        &lt;-- ati9
                        --&gt; NDID = 12345
                        --&gt; OK
                        --&gt;
                        --&gt; RING
                        --&gt;
                        --&gt; RING
                        &lt;-- ata
</code></pre>

<p>--&gt; CONNECT                 --&gt; CONNECT
&lt;-- x
--&gt; OK
&lt;-- ath
--&gt; OK
                            --&gt;
                            --&gt; ERROR
&lt;-- at
--&gt; OK
                            &lt;-- at
                            --&gt; OK
...                         ...</p>

<h2>
<a name="33-example-of-cisco-config-loopback" class="anchor" href="#33-example-of-cisco-config-loopback"><span class="octicon octicon-link"></span></a>3.3. Example of Cisco config (loopback)</h2>

<p>10.0.2.12 --&gt; Cisco port 2:D --E1-cable--&gt; Cisco port 3:D --&gt; 10.0.2.12</p>

<p>dial-peer voice 3340 voip
 incoming called-number 3334....
 codec g711alaw
 fax rate 14400
 fax protocol t38 ls-redundancy 0 hs-redundancy 0</p>

<p>dial-peer voice 3341 pots
 destination-pattern 3334....
 port 2:D
 forward-digits 7</p>

<p>dial-peer voice 3342 pots
 incoming called-number 334....
 direct-inward-dial
 port 3:D
exit</p>

<p>dial-peer voice 3343 voip
 destination-pattern 334....
 session target ipv4:10.0.2.12
 codec g711alaw
 fax rate 14400
 fax protocol t38 ls-redundancy 0 hs-redundancy 0
exit</p>

<h2>
<a name="34-example-of-hylafax-modem-config-files" class="anchor" href="#34-example-of-hylafax-modem-config-files"><span class="octicon octicon-link"></span></a>3.4. Example of HylaFAX modem config files</h2>

<p>Copy HylaFAX/etc/config.ttyx to HylaFAX's etc directory</p>

<p>Create simbolic links:</p>

<p>config.ttyx0 -&gt; config.ttyx
config.ttyx1 -&gt; config.ttyx</p>

<p>Start HylaFAX with new modems:</p>

<p>$ .../faxgetty -D ttyx0
$ .../faxgetty -D ttyx1</p>

<p>(FreeBSD users - don't forget we are using ttypa and ttypb)</p>

<h2>
<a name="4-at-commands-specific-to-t38modem" class="anchor" href="#4-at-commands-specific-to-t38modem"><span class="octicon octicon-link"></span></a>4. AT commands specific to t38modem</h2>

<h2>
<a name="41-atcid-command" class="anchor" href="#41-atcid-command"><span class="octicon octicon-link"></span></a>4.1. AT#CID command</h2>

<h2>
<a name="411-reporting-caller-id-and-did-after-the-first-ring" class="anchor" href="#411-reporting-caller-id-and-did-after-the-first-ring"><span class="octicon octicon-link"></span></a>4.1.1 Reporting Caller ID and DID after the first RING</h2>

<h1>
<a name="cid0----disable-caller-id-and-did-reporting-default" class="anchor" href="#cid0----disable-caller-id-and-did-reporting-default"><span class="octicon octicon-link"></span></a>CID=0  - disable Caller ID and DID reporting (default).</h1>

<h1>
<a name="cid1----enable-only-caller-id-reporting" class="anchor" href="#cid1----enable-only-caller-id-reporting"><span class="octicon octicon-link"></span></a>CID=1  - enable only Caller ID reporting.</h1>

<h1>
<a name="cid10---enable-caller-id-and-did-reporting" class="anchor" href="#cid10---enable-caller-id-and-did-reporting"><span class="octicon octicon-link"></span></a>CID=10 - enable Caller ID and DID reporting.</h1>

<h1>
<a name="cid11---enable-only-did-reporting" class="anchor" href="#cid11---enable-only-did-reporting"><span class="octicon octicon-link"></span></a>CID=11 - enable only DID reporting.</h1>

<p>Example:</p>

<p>&lt;-- AT#CID=10
--&gt; OK
--&gt; RING
--&gt; DATE =               ; Caller ID
--&gt; TIME =               ; Caller ID
--&gt; NMBR =     ; Caller ID
--&gt; NAME =       ; Caller ID
--&gt; NDID =      ; DID
--&gt; RING
--&gt; RING</p>

<h2>
<a name="42-ati-command" class="anchor" href="#42-ati-command"><span class="octicon octicon-link"></span></a>4.2. ATI command</h2>

<h2>
<a name="421-callingcalled-number-reporting" class="anchor" href="#421-callingcalled-number-reporting"><span class="octicon octicon-link"></span></a>4.2.1 calling/called number reporting</h2>

<p>I8  - reports calling number for last incoming call.
I9  - reports called number for last incoming call.</p>

<p>Example:</p>

<p>&lt;-- ATI8I9
--&gt; NMBR = 
--&gt; NDID = 
--&gt; OK</p>

<h2>
<a name="43-atd-command" class="anchor" href="#43-atd-command"><span class="octicon octicon-link"></span></a>4.3. ATD command</h2>

<h2>
<a name="431-fax-mode-modifiers" class="anchor" href="#431-fax-mode-modifiers"><span class="octicon octicon-link"></span></a>4.3.1 Fax mode modifiers</h2>

<p>F - force fax mode (T.38 or G.711 pass-trough) after dialing
    (with OPAL can be overriden by route option OPAL-Force-Fax-Mode=false).
V - do not force fax mode after dialing (default)
    (with OPAL can be overriden by route option OPAL-Force-Fax-Mode=true).</p>

<p>Examples:</p>

<p>&lt;-- ATDF</p>

<pre><code>force fax mode after dialing but user can override it by
inserting V into &lt;user's number&gt;.
</code></pre>

<p>&lt;-- ATDV</p>

<pre><code>do not force fax mode after dialing and user can't override it
by inserting F into &lt;user's number&gt;.
</code></pre>

<h2>
<a name="432-callingcalled-number-modifiers" class="anchor" href="#432-callingcalled-number-modifiers"><span class="octicon octicon-link"></span></a>4.3.2 calling/called number modifiers</h2>

<p>L     - purge calling number and start dialing it.
T,P,D - continue to dial of called number if dialing of calling number was started.</p>

<p>If calling number is empty after processing ATD command then t38modem's
local party number used.</p>

<p>The calling number is a string of 0 or more of the characters:</p>

<p>"0 1 2 3 4 5 6 7 8 9 * #"</p>

<p>Note: dialing of calling number is not allowed in online command state.</p>

<p>The called number is a string of 0 or more of the characters:</p>

<p>"0 1 2 3 4 5 6 7 8 9 * # + A B C D"</p>

<p>Note: '+' will be ignored in online command state or after '@' modifier.</p>

<p>Examples:</p>

<p>&lt;-- ATD</p>

<pre><code>calling number is t38modem's local party number but user can override
it by inserting L&lt;user's calling number&gt; into &lt;user's number&gt;
</code></pre>

<p>&lt;-- ATDL</p>

<pre><code>calling number is t38modem's local party number and user can't override
it by inserting L&lt;user's calling number&gt; into &lt;user's number&gt;
</code></pre>

<p>&lt;-- ATDLT</p>

<pre><code>calling number is &lt;calling number&gt; but user can override
it by inserting L&lt;user's calling number&gt; into &lt;user's number&gt;
</code></pre>

<p>&lt;-- ATDL</p>

<pre><code>calling number is &lt;calling number&gt; and user can't override
it by inserting L&lt;user's calling number&gt; into &lt;user's number&gt;
</code></pre>

<h2>
<a name="433-wait-for-answer-modifier" class="anchor" href="#433-wait-for-answer-modifier"><span class="octicon octicon-link"></span></a>4.3.3 Wait for answer modifier</h2>

<p>@ - dial the called number part collected before first @, wait till the call
    answered and play the called number part collected after last @.
    Implicitly '@' will continue dialing of called number (see 4.3.2).</p>

<p>Examples:</p>

<p>&lt;-- ATS8?
--&gt; 002
--&gt; OK
&lt;-- ATD12345@,,,4321</p>

<pre><code>dial number 12345, wait till the call answered, wait 6 seconds
(3 commas * 2 seconds), play digits 4321.
</code></pre>

<p>&lt;-- ATD12345@,,,4321@</p>

<pre><code>dial number 12345.
</code></pre>

<h2>
<a name="44-atdfrmc-command" class="anchor" href="#44-atdfrmc-command"><span class="octicon octicon-link"></span></a>4.4. AT#DFRMC command</h2>

<h2>
<a name="441-set-delay-for-connect-result-code-for-atfrm-command" class="anchor" href="#441-set-delay-for-connect-result-code-for-atfrm-command"><span class="octicon octicon-link"></span></a>4.4.1 Set delay for CONNECT result code for AT+FRM command</h2>

<h1>
<a name="dfrmc0------disable-delay-default" class="anchor" href="#dfrmc0------disable-delay-default"><span class="octicon octicon-link"></span></a>DFRMC=0    - disable delay (default).</h1>

<h1>
<a name="dfrmc25-----set-delay-to-250-ms" class="anchor" href="#dfrmc25-----set-delay-to-250-ms"><span class="octicon octicon-link"></span></a>DFRMC=25   - set delay to 250 ms.</h1>

<h2>
<a name="45-athclr-command" class="anchor" href="#45-athclr-command"><span class="octicon octicon-link"></span></a>4.5. AT#HCLR command</h2>

<h2>
<a name="451-set-clear-call-mode-for-ath-command" class="anchor" href="#451-set-clear-call-mode-for-ath-command"><span class="octicon octicon-link"></span></a>4.5.1 Set clear call mode for ATH command</h2>

<h1>
<a name="hclr0---ath-command-will-not-clear-not-answered-incoming-call-default" class="anchor" href="#hclr0---ath-command-will-not-clear-not-answered-incoming-call-default"><span class="octicon octicon-link"></span></a>HCLR=0 - ATH command will not clear not answered incoming call (default).</h1>

<h1>
<a name="hclr1---ath-command-will-clear-not-answered-incoming-call" class="anchor" href="#hclr1---ath-command-will-clear-not-answered-incoming-call"><span class="octicon octicon-link"></span></a>HCLR=1 - ATH command will clear not answered incoming call.</h1>

<h2>
<a name="46-atcidfmt-command" class="anchor" href="#46-atcidfmt-command"><span class="octicon octicon-link"></span></a>4.6. AT#CIDFMT command</h2>

<p>AT#CIDFMT command allows to set value format for NAME and NMBR tags of Caller ID.</p>

<p>Syntax:</p>

<p>#CIDFMT=[][,[]]</p>

<p>If a format element is empty then its value will be untouched.</p>

<p>Subparameter :</p>

<p>0   - report "NAME = " (default)
  1   - report "NAME = "
  2   - report "NAME = "
  3   - report "NAME =  &lt;- "</p>

<p>Subparameter :</p>

<p>0   - report "NMBR = " (default)
  1   - report "NMBR = "
  2   - report "NMBR = "
  3   - report "NMBR = #"</p>
        </section>

        <footer>
          T38modem is maintained by <a href="https://github.com/Distrotech">Distrotech</a><br>
          This page was generated by <a href="http://pages.github.com">GitHub Pages</a>. Tactile theme by <a href="http://twitter.com/jasonlong">Jason Long</a>.
        </footer>

        
      </div>
    </div>
  </body>
</html>